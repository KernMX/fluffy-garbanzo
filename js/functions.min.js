function approSum(e){var i=e.plus(1),a=i.sqrt(),l=i.times(a),t=i.times(l).times(.4),s=l.times(.5),n=a.times(.125),c=Decimal(52e-5).div(l);return t.minus(s).plus(n).minus(c).ceil()}function decFormatNoGrouping(e){return e.toFixed(0)}function decFormatEasyCopy(e){if(e.gte(1e5)){for(var i=Decimal(e).toFixed(0),a=0;"0"===i[i.length-1];)a++,i=i.substring(0,i.length-1);return 0==a?i:i+"e"+a}return decFormatNoGrouping(e)}function fracFormat(e){return e.toFixed(2)}function sciFormat(e,i){return e.gte(1e5)?Decimal(e).toExponential(i).toString().replace("+",""):decFormatNoGrouping(e)}function calcTranscendentPower(){var e=Decimal(rawData.ancientSoulsTotal);return Decimal(50).minus(Decimal(49).times(e.neg().div(1e4).exp())).plus(outsider[3].Multiplier).div(100)}function getHeroSouls(){var e=Decimal(rawData.heroSouls);return $("#useNextAscensionSouls").prop("checked")&&(e=e.plus(Decimal(rawData.primalSouls)).plus(Decimal(rawData.totalHeroLevels).div(2e3).floor())),$("#manualHS").val(decFormatNoGrouping(e)),e}function getAscensionZone(){var e=Decimal(rawData.highestFinishedZonePersist);if(""!=$("#ascensionZone").val())i=Decimal($("#ascensionZone").val());else var i=Decimal(0);var a=e.gte(i)?e:i;return $("#ascensionZone").val(a.toString()),a}function getCurrentRatio(){var e=ancient[5].Level,i=ancient[19].Level;e.equals(0)?i.gt(0)?$("#playstyleSelect").prop("selectedIndex",2).change():$("#playstyleSelect").prop("selectedIndex",0).change():i.equals(0)?$("#playstyleSelect").prop("selectedIndex",0).change():i.div(e).lt(.1)?$("#playstyleSelect").prop("selectedIndex",0).change():i.div(e).gt(10)?$("#playstyleSelect").prop("selectedIndex",2).change():(ratio=i.div(e).times(20).round().div(20),$("#hybridRatio").val(ratio.toString()),$("#playstyleSelect").prop("selectedIndex",1).change())}function getSolomonMultiplier(e,i){for(var a=e.times(5),l=1;l<5;l++)e.gt(20*l)&&(a=a.minus(e.minus(20*l)));return a=a.times(i.plus(1)).div(100).plus(1)}function showASGain(e){var i=Decimal(rawData.ancientSoulsTotal),a=Decimal(rawData.heroSoulsSacrificed).plus(Decimal(rawData.heroSouls));$("#useNextAscensionSouls").prop("checked")&&(a=a.plus(Decimal(rawData.primalSouls)));for(var l in rawData.ancients.ancients)a=a.plus(Decimal(rawData.ancients.ancients[l].spentHeroSouls));var t=Decimal.log10(a).times(5).floor().minus(i);$("#asGainIfTranscend").text(t.toString());for(l=1;l<4;l++)$("#asGain"+l).text(t.plus(l).plus(e).toString()),$("#hsToGain"+l).text(sciFormat(Decimal(10).pow(i.plus(t).plus(l).plus(e).div(5)).minus(a),4))}function getNUALevel(e,i,a,l,t){for(var s=l.div(e),n=Decimal(0),c=Decimal(1e6);c.minus(n).gt(1);){var o=c.plus(n).div(2).floor();Decimal.pow(2*Math.exp(i),o).times(Decimal.pow(Math.exp(1),o.times(-i)).times(t).plus(a)).lte(s)?n=o:c=o}return c}function loadGame(){var e=$("#sg").val();if(e.indexOf("Fe12NAfA3R6z4k0z")>0){e=e.split("Fe12NAfA3R6z4k0z")[0];for(var i="",a=0;a<e.length;a+=2)i+=e[a];rawData=JSON.parse(atob(i))}for(var l in outsider)outsider[l].Level=Decimal(rawData.outsiders.outsiders[l].level);for(var l in ancient)ancient[l].OptimalLevel=Decimal(0),ancient[l].CostToOptimal=Decimal(0),rawData.ancients.ancients[l]?(ancient[l].Level=Decimal(rawData.ancients.ancients[l].level),summonedAncients++):ancient[l].Level=Decimal(0);isSaveLoaded=!0}function showOutsider(){var e=document.getElementById("osdtable");for(var i in outsider)e.rows[i].cells[1].innerHTML=outsider[i].Level.toString();outsider[1].Multiplier=outsider[1].Level,outsider[2].Multiplier=Decimal(1).minus(Decimal(.95).pow(outsider[2].Level)),outsider[3].Multiplier=Decimal(50).minus(outsider[3].Level.neg().div(1e3).exp().times(50)),outsider[4].Multiplier=outsider[4].Level.div(10),outsider[5].Multiplier=outsider[5].Level,e.rows[1].cells[2].innerHTML="+"+outsider[1].Multiplier.times(100).toString()+"% effective of all Idle bonuses",e.rows[2].cells[2].innerHTML="-"+fracFormat(outsider[2].Multiplier.times(100))+"% Ancient cost",e.rows[3].cells[2].innerHTML="+"+fracFormat(outsider[3].Multiplier)+"% Transcendent Power (additive)",e.rows[4].cells[2].innerHTML="+"+outsider[4].Multiplier.times(100).toString()+"% maximum transcendent primal soul reward",e.rows[5].cells[2].innerHTML="+"+outsider[5].Multiplier.times(100).toString()+"% effective of Solomon";var a=calcTranscendentPower(),l=outsider[4].Multiplier.plus(1).times(.05).times(Decimal(rawData.heroSoulsSacrificed)),t=(ancient[3].Level,getSolomonMultiplier(ancient[3].Level,outsider[5].Multiplier)),s=l.div(t.times(20)).ln().div(a.plus(1).ln()).ceil().times(5).plus(100),n=Decimal(rawData.ancientSoulsTotal),c=Decimal(rawData.heroSoulsSacrificed).plus(Decimal(rawData.heroSouls));for(var i in rawData.ancients.ancients)c=c.plus(Decimal(rawData.ancients.ancients[i].spentHeroSouls));var o=Decimal.log10(c).times(5).floor().minus(n);$("#tp").text(fracFormat(a.times(100))),$("#maxTPReward").text(sciFormat(l,4)),$("#zoneCap").text(decFormatNoGrouping(s)),$("#as").text(n.toString()),$("#asGainIfTranscend").text(o.toString()),showASGain(additionalASShow)}function compute(e){var i=Decimal(1.14).plus(ascZone.div(500).ceil().times(.005));if($("#wep8k").prop("checked"))a=Decimal(1.1085).times(Decimal.ln(calcTranscendentPower().plus(1))).div(Decimal.ln(i));else var a=Decimal(1.4067).times(Decimal.ln(calcTranscendentPower().plus(1))).div(Decimal.ln(i));var l,t,s;switch($("#playstyleSelect").val()){case"idle":l=ancient[5].Level.plus(e),t=Decimal(0),s=l;break;case"hybrid":t=(l=ancient[5].Level.plus(e)).times(ratio),s=Decimal.max(l,t);break;case"active":l=Decimal(0),s=t=ancient[19].Level.plus(e)}for(var n in ancient)if(ancient[n].Level.gt(0)&&"true"==ancient[n].Visible)switch(n){case"3":ancient[n].OptimalLevel=s.pow(.8).div(a.pow(.4)).ceil();break;case"4":$("#wep8k").prop("checked")?ancient[n].OptimalLevel=l.times(.905).ceil():ancient[n].OptimalLevel=l.times(.926).ceil();break;case"8":case"9":$("#wep8k").prop("checked")?ancient[n].OptimalLevel=s.times(.905).ceil():ancient[n].OptimalLevel=s.times(.926).ceil();break;case"5":ancient[n].OptimalLevel=l;break;case"11":ancient[n].OptimalLevel=Decimal.min(3743,getNUALevel(200*Math.log(2),.01,1/99,s.times(.927).pow(2),1));break;case"12":ancient[n].OptimalLevel=Decimal.min(14972,getNUALevel(800*Math.log(2),.0025,10/9,s.times(.927).pow(2),-1));break;case"13":ancient[n].OptimalLevel=Decimal.min(2880,getNUALevel(2/.013*Math.log(2),.013,4/3,s.pow(2).div(a),-1));break;case"14":ancient[n].OptimalLevel=Decimal.min(18715,getNUALevel(1e3*Math.log(2),.002,100/99,s.times(.927).pow(2),-1));break;case"15":ancient[n].OptimalLevel=t;break;case"16":ancient[n].OptimalLevel=s.pow(2);break;case"17":ancient[n].OptimalLevel=Decimal.min(1101,getNUALevel(2/.034*Math.log(2),.034,2,s.pow(2),-1));break;case"18":ancient[n].OptimalLevel=Decimal.min(1872,getNUALevel(100*Math.log(2),.02,1,s.pow(2),1));break;case"19":ancient[n].OptimalLevel=t;break;case"21":ancient[n].OptimalLevel=Decimal.min(3743,getNUALevel(200*Math.log(2),.01,.25,s.pow(2).div(a),1));break;case"28":ancient[n].OptimalLevel=s;break;case"29":ancient[n].OptimalLevel=t.pow(.8).ceil();break;case"32":$("#wep8k").prop("checked")?ancient[n].OptimalLevel=l.times(.905).pow(.8).ceil():ancient[n].OptimalLevel=l.times(.926).pow(.8).ceil()}for(var n in ancient)if(ancient[n].Level.gt(0))switch(n){case"20":ancient[n].OptimalLevel=Decimal.min(1440,Decimal.max(ancient[$("#otherAncientsLowerBase").val()].OptimalLevel.minus($("#otherAncientsLower").val(),0)));break;case"31":ancient[n].OptimalLevel=Decimal.min(3743,Decimal.max(ancient[$("#otherAncientsLowerBase").val()].OptimalLevel.minus($("#otherAncientsLower").val(),0)));break;case"22":case"23":case"24":case"25":case"26":case"27":ancient[n].OptimalLevel=Decimal.max(ancient[$("#otherAncientsLowerBase").val()].OptimalLevel.minus($("#otherAncientsLower").val(),0))}var c=Decimal(0);for(var n in ancient){var o=Decimal(0),e=ancient[n].Level,m=ancient[n].OptimalLevel;if(m.gt(e)&&"true"===ancient[n].Visible)switch(n){case"3":case"29":case"32":o=approSum(m).minus(approSum(e));break;case"4":case"5":case"8":case"9":case"15":case"19":case"28":o=m.times(m.plus(1)).div(2).minus(e.times(e.plus(1)).div(2));break;case"11":case"12":case"13":case"14":case"17":case"18":case"20":case"21":case"22":case"23":case"24":case"25":case"26":case"27":case"26":case"31":o=Decimal.pow(2,m.plus(1)).minus(Decimal.pow(2,e.plus(1)));break;case"16":o=m.minus(e)}ancient[n].CostToOptimal=o.times(Decimal(1).minus(outsider[2].Multiplier)).ceil(),c=c.plus(ancient[n].CostToOptimal)}return c}function optimizeAncient(){if(0!=summonedAncients){var e,a,l,t,s;for(l="active"==$("#playstyleSelect").val()?ancient[19].Level:ancient[5].Level,compute(0).gt(hs)?(e=l.neg(),a=Decimal(0)):(e=Decimal(0),a=hs.div(Decimal(1).minus(outsider[2].Multiplier)).plus(l.times(l.plus(1)).times(2)).sqrt().ceil().minus(l));a.minus(e).gt(Decimal.max(1,Decimal.max(l,a.plus(l)).times(1e-15)));){var n=a.plus(e).div(2).floor();t=compute(n),s=ancient[16].Level.equals(0)?Decimal.pow(Decimal.max(ancient[5].OptimalLevel,ancient[19].OptimalLevel),2):0,t.plus(s).lte(hs)?e=n:a=n}var c=compute(e)}var o=[];for(var m in ancient)o.push(ancient[m]);o.sort(function(e,i){var a=e.Name.toLowerCase(),l=i.Name.toLowerCase();return a===l?0:a>l?1:-1});var r=document.getElementById("anctable");if(r.rows[1].cells[0].innerHTML="Hero Souls",$("#manualHS").val(sciFormat(hs,4)),r.rows[1].cells[2].innerHTML=sciFormat(hs.minus(c),4),r.rows[1].cells[3].innerHTML="-"+sciFormat(c,4),0==ancientTableShow){for(var u=0;u<26;u++)$("#anctable").append('<tr style="display: table-row;"><td></td><td class="text-right"></td><td class="text-right"></td><td><input id="'+u+'" class="form-control rs text-right bold " type="text"></input></td><td class="text-right"></td></tr>');$(".rs").map(function(){$(this).focus(function(){$(this).val(decFormatEasyCopy(Decimal.max(0,o[this.id].OptimalLevel.minus(o[this.id].Level))))}),$(this).focusout(function(){$(this).val(sciFormat(Decimal.max(0,o[this.id].OptimalLevel.minus(o[this.id].Level)),4))})}),ancientTableShow=1}i=2;for(var m in o)r.rows[i].cells[0].innerHTML=o[m].Name,r.rows[i].cells[1].innerHTML=sciFormat(o[m].Level,4),r.rows[i].cells[2].innerHTML=sciFormat(o[m].OptimalLevel,4),r.rows[i].cells[3].firstChild.value=sciFormat(Decimal.max(0,o[m].OptimalLevel.minus(o[m].Level)),4),r.rows[i].cells[4].innerHTML=sciFormat(o[m].CostToOptimal,4),"false"==o[m].Visible||0==o[m].Level?r.rows[i].style.display="none":r.rows[i].style.display="table-row",i++}function showBossRaidData(){var e=Decimal(rawData.titanDamage),i=Decimal(rawData.autoclickers).plus(rawData.dlcAutoclickers);if(i.equals(0))a=Decimal.log(e).plus(Decimal.log(7.2)).div(Decimal.log(2)).floor();else var a=Decimal.log(e).plus(Decimal.log(i)).plus(Decimal.log(1.8)).div(Decimal.log(2)).floor();$("#immortalDamage").text(sciFormat(e,4)),i.equals(0)?$("#ac").text("1200 clicks/try"):i.equals(1)?$("#ac").text(i.toString()+" autoclicker"):$("#ac").text(i.toString()+" autoclickers"),$("#highestBossLevel").text(a.toString())}Decimal.config({precision:17});var rawData="",hs=Decimal(0),ascZone=new Decimal(0),ancientTableShow=0,summonedAncients=0,ratio=Decimal(1),isSaveLoaded=!1,additionalASShow=new Decimal(0),ancient={3:{Name:"Solomon",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},4:{Name:"Libertas",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},5:{Name:"Siyalatas",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},8:{Name:"Mammon",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},9:{Name:"Mimzee",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},11:{Name:"Dogcog",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},12:{Name:"Fortuna",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},13:{Name:"Atman",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},14:{Name:"Dora",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},15:{Name:"Bhaal",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},16:{Name:"Morgulis",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},17:{Name:"Chronos",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},18:{Name:"Bubos",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},19:{Name:"Fragsworth",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},20:{Name:"Vaagur",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},21:{Name:"Kumawakamaru",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},22:{Name:"Chawedo",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},23:{Name:"Hecatoncheir",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},24:{Name:"Berserker",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},25:{Name:"Sniperino",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},26:{Name:"Kleptos",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},27:{Name:"Energon",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},28:{Name:"Argaiv",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"},29:{Name:"Juggernaut",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},31:{Name:"Revolc",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"false"},32:{Name:"Nogardnit",Level:Decimal(0),OptimalLevel:Decimal(0),CostToOptimal:Decimal(0),Visible:"true"}},outsider={1:{Name:"Xyliqil",Level:Decimal(0),Multiplier:Decimal(0)},2:{Name:"Chor'gorloth",Level:Decimal(0),Multiplier:Decimal(0)},3:{Name:"Phandoryss",Level:Decimal(0),Multiplier:Decimal(0)},4:{Name:"Borb",Level:Decimal(0),Multiplier:Decimal(0)},5:{Name:"Ponyboy",Level:Decimal(0),Multiplier:Decimal(0)}};$(document).ready(function(){$("#useDarkTheme").change(function(){$(this).prop("checked")?$("#style").attr("href","https://bootswatch.com/darkly/bootstrap.min.css"):$("#style").attr("href","https://bootswatch.com/flatly/bootstrap.min.css")}),$("#anctable").append('<tr><td></td><td class="text-right"></td><td class="text-right"></td><td class="text-right bold"></td><td></td></tr>');var e=document.createElement("input");e.className="text-right form-control",e.type="text",e.placeholder="Your desire HS (current HS if ignored)",e.id="manualHS";var i=document.getElementById("anctable");i.rows[1].cells[0].innerHTML="Hero Souls",i.rows[1].cells[1].appendChild(e),$("#sg").change(function(){loadGame(),ascZone=getAscensionZone(),hs=getHeroSouls(),showOutsider(),showBossRaidData(),getCurrentRatio()}),$("#ascensionZone").change(function(){ascZone=Decimal($(this).val()).gt(0)?Decimal($(this).val()):getAscensionZone(),isSaveLoaded&&optimizeAncient()}),$("#manualHS").change(function(){hs=Decimal($(this).val()).gt(0)?Decimal($(this).val()):getHeroSouls(),isSaveLoaded&&optimizeAncient()}),$("#useNextAscensionSouls").change(function(){isSaveLoaded&&(hs=getHeroSouls(),optimizeAncient(),showASGain(additionalASShow))}),$(document).on("click","input",function(){$(this).select()}),$("#playstyleSelect").change(function(){"idle"==$(this).val()?($("#hybridRatioContainer").hide(),ancient[4].Visible="true",ancient[5].Visible="true",ancient[32].Visible="true",ancient[15].Visible="false",ancient[19].Visible="false",ancient[29].Visible="false"):"hybrid"==$(this).val()?($("#hybridRatioContainer").show(),ancient[4].Visible="true",ancient[5].Visible="true",ancient[32].Visible="true",ancient[15].Visible="true",ancient[19].Visible="true",ancient[29].Visible="true"):"active"==$(this).val()&&($("#hybridRatioContainer").hide(),ancient[4].Visible="false",ancient[5].Visible="false",ancient[32].Visible="false",ancient[15].Visible="true",ancient[19].Visible="true",ancient[29].Visible="true"),isSaveLoaded&&optimizeAncient()}),$("#hybridRatio, #wep8k").on("change",function(){ratio=Decimal($("#hybridRatio").val()),isSaveLoaded&&optimizeAncient()}),$("#flagCalculateOtherAncients").on("change",function(){$(this).prop("checked")?(ancient[20].Visible="true",ancient[22].Visible="true",ancient[23].Visible="true",ancient[24].Visible="true",ancient[25].Visible="true",ancient[26].Visible="true",ancient[27].Visible="true",ancient[31].Visible="true"):(ancient[20].Visible="false",ancient[22].Visible="false",ancient[23].Visible="false",ancient[24].Visible="false",ancient[25].Visible="false",ancient[26].Visible="false",ancient[27].Visible="false",ancient[31].Visible="false"),isSaveLoaded&&optimizeAncient()}),$("#otherAncientsLower, #otherAncientsLowerBase").on("change",function(){isSaveLoaded&&optimizeAncient()}),$("#buttonLessAS").on("click",function(){isSaveLoaded&&showASGain(additionalASShow=Decimal.max(additionalASShow.minus(1),0))}),$("#buttonMoreAS").on("click",function(){isSaveLoaded&&showASGain(additionalASShow=Decimal.min(additionalASShow.plus(1),27))})});